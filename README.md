# TOEFL Vocab SRS

一个面向 **TOEFL iBT / TPO 阅读词汇** 的本地间隔复习（SRS）网页应用（类 Anki）。

- **纯前端**：TailwindCSS（CDN）+ jQuery + 少量自定义 CSS
- **本地优先**：默认只使用浏览器本地存储（`localStorage`），不上传任何数据
- **托福定向**：支持 `topic / pos` 标签、英→中识别 + 中→英拼写、AI 助教多轮问答、学习统计与薄弱项分析

---

## 目录

- [快速开始](#快速开始)
- [核心功能](#核心功能)
  - [牌组](#牌组)
  - [导入单词（支持 TPO 标签）](#导入单词支持-tpo-标签)
  - [复习/学习流程（会话选择）](#复习学习流程会话选择)
  - [复习模式：英→中 / 中→英（拼写）](#复习模式英中--中英拼写)
  - [筛选：topic / pos](#筛选topic--pos)
  - [发音（TTS）](#发音tts)
  - [AI 助教抽屉（DeepSeek，多轮追问）](#ai-助教抽屉deepseek多轮追问)
  - [统计：14 天游走 + topic/pos 薄弱项](#统计14-天游走--topicpos-薄弱项)
- [数据存储与备份（重要）](#数据存储与备份重要)
  - [保存在哪里](#保存在哪里)
  - [导出 JSON → 修改 → 导入（数据管理工作流）](#导出-json--修改--导入数据管理工作流)
- [导入格式规范（强约束）](#导入格式规范强约束)
- [学习算法说明（EF/reps/interval）](#学习算法说明efrepsinterval)
- [常见问题（FAQ）](#常见问题faq)
- [项目结构](#项目结构)
- [部署建议（GitHub Pages）](#部署建议github-pages)
- [License](#license)

---

## 快速开始

### 方式一：直接打开 `index.html`

1. 克隆/下载本仓库
2. 双击打开 `index.html`

说明：
- 这种方式最简单，但不同浏览器对本地文件的存储隔离策略可能不同。

### 方式二：本地静态服务器（推荐）

任意静态服务器都可，例如：

```bash
python -m http.server 5173
```

打开：

- `http://localhost:5173`

说明：
- 这种方式更接近部署到 GitHub Pages 的运行环境。

---

## 核心功能

### 牌组

在「牌组」页可以：
- 创建 / 选择当前牌组
- 重命名 / 删除（删除会同时删除该牌组所有卡片）

---

### 导入单词（支持 TPO 标签）

在「导入」页：
- 粘贴文本 → `解析并预览` → `确认导入`
- 支持 **重复策略**：
  - 跳过重复
  - 覆盖旧卡（只覆盖内容字段，保留复习参数 EF/reps/interval 等）

---

### 复习/学习流程（会话选择）

在「复习」页，你会先看到 3 个会话面板：

1. **学习新卡**
- 仅包含从未学习过的卡（`lastReviewedAt` 为空）
- 受「每日新增上限」控制

2. **复习旧卡（到期）**
- **只包含已到期**的复习卡（优先级最高）
- 提供：开始复习 + 预览到期列表

3. **巩固学习（未到期）**
- 包含**已学过但未到期**的卡
- 适合在学完新卡后加练
- 提供：开始巩固 + 预览巩固列表

在会话进行中：
- 右上角有 `跳过`
- 右上角有 `返回选择`：你可以主动中止当前会话并回到 3 个面板切换

---

### 复习模式：英→中 / 中→英（拼写）

复习区域提供两种模式：

#### 英→中（识别）
- 默认展示英文单词（正面）
- **中文释义需要点击 `显示释义` 才展开**（符合你“只隐藏中文释义”的要求）
- 例句/元信息默认显示
- 可以直接打分：忘了 / 模糊 / 记得

#### 中→英（拼写）
- 显示中文释义作为提示
- 你输入英文拼写，提交后自动判定对错

---

### 筛选：topic / pos

在复习区域可以设置筛选条件：
- `topic`：如 `astronomy` / `geology` / `biology`
- `pos`：如 `n` / `v` / `adj` / `adv`

筛选作用：
- 会影响：新学 / 到期复习 / 巩固学习 的队列构建

匹配规则：
- `topic`：忽略大小写与多余空格后做精确匹配
- `pos`：前缀匹配（输入 `adj` 可匹配 `adj.`）

---

### 发音（TTS）

- 英→中模式：`发音` 按钮朗读当前英文单词
- 中→英模式：拼写区域的 `发音` 按钮朗读当前英文单词
- 仅朗读英文（`en-US`）

说明：
- 依赖浏览器 Web Speech API：`speechSynthesis`
- 若浏览器不支持会提示

---

### AI 助教抽屉（DeepSeek，多轮追问）

在「复习」页右下角有一个 AI 按钮，打开后是右侧抽屉：

- 支持输入并保存 **DeepSeek API Key**（仅保存在本机 `localStorage`）
- 支持多轮对话与追问
- **短记忆**：保留最近约 10 轮（约 20 条消息）
- 支持 `注入当前卡片上下文`：自动把 word/meaning/example/topic/pos/syn/coll 注入输入框
- AI 回复支持 **Markdown 渲染**（含列表、标题、代码块等）

安全提示（重要）：
- 这是**纯前端直连 API**的方案，API Key 在浏览器侧可见
- 不要在公开部署的站点里填写高权限 Key

---

### 统计：14 天游走 + topic/pos 薄弱项

统计页包含：
- 今日学习（总）
- 今日正确率（含今日新增数）
- 到期复习数量
- 待学新卡数量

并提供：
- **近 14 天游走**：柱状趋势（当天学习次数）
- **按 topic/pos 薄弱项分析**：
  - 基于 `logsByDay[date].events` 的逐卡事件做聚合
  - 正确率低的排在前面（用于定位薄弱主题/词性）

---

## 数据存储与备份（重要）

### 保存在哪里

默认保存于浏览器 `localStorage`：
- 不写入磁盘文件
- 不上传服务器

### 导出 JSON → 修改 → 导入（数据管理工作流）

在统计页可：
- **导出数据（JSON）**：下载完整备份
- **导入备份（JSON）**：恢复

你如果想在项目目录里“落盘管理”，推荐工作流：
1. 导出 JSON，保存到仓库目录
2. 需要批量修改时编辑该 JSON
3. 再导入覆盖

#### 可以改什么
主要改 `cards` 里的内容字段：
- `front`：英文单词
- `back`：中文释义
- `example`：例句
- `pos` / `topic` / `syn` / `collocation`

#### 不要改什么（非常重要）
- 不要改 `id`
- 不要随意改 `deckId`（除非你明确要移动卡片）
- 不要把 `cards` 从对象改成数组（结构必须保持一致）

#### 删除卡片对统计的影响
- 旧的 events 可能仍引用被删的 cardId
- 本项目统计时会跳过找不到的 cardId（不影响导入与运行）

---

## 导入格式规范（强约束）

### 推荐格式：7 列 TAB 分隔

每行一条：

```
word\tmeaning\texample\tpos\ttopic\tsyn\tcollocation
```

示例：

```
supernova\t超新星\tA supernova marks the explosive death of a massive star.\tn\tastronomy\texplosion,stellar death\tcore-collapse supernova,supernova remnant
```

说明：
- 支持 TAB 或逗号分隔
- 兼容 2~3 列简化格式：
  - `word\tmeaning`
  - `word\tmeaning\texample`

---

## 学习算法说明（EF/reps/interval）

本项目使用 SM-2 inspired 的调度：

- **易记系数（EF）**：越大表示越容易记住，间隔增长更快
- **连续记住次数（reps）**：连续“记住”的次数
- **下次间隔（interval）**：本次作答后距离下次复习的天数

你的操作与打分：
- 英→中模式：忘了/模糊/记得
- 中→英拼写：
  - 拼写正确 ≈ 记得
  - 拼写错误 ≈ 忘了

---

## 常见问题（FAQ）

### 1) 为什么 topic/pos 没数据？
- 需要产生 `logsByDay[date].events`（也就是你至少完成过一些学习/复习）
- 或者你导入的是旧备份（没有 events），从现在开始会逐步有数据

### 2) 换浏览器/换电脑数据没了？
- 因为是 `localStorage`
- 解决：导出 JSON → 在新环境导入

### 3) AI 抽屉里 Key 安全吗？
- Key 只保存在本机浏览器
- 但纯前端直连意味着它可被查看，不要在公开站点使用敏感 Key

---

## 项目结构

- `index.html`：单页 UI
- `app.js`：业务逻辑（导入、队列、复习调度、统计、AI 抽屉等）
- `app.css`：少量自定义样式

---

## 部署建议（GitHub Pages）

这是纯前端项目，可以直接部署到 GitHub Pages。

注意：
- AI 功能如果在公开站点使用，API Key 会暴露，建议改为后端代理（本仓库默认不提供）。

---

## License

MIT
