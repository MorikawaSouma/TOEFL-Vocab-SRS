# TOEFL Vocab SRS

一个面向 **TOEFL iBT / TPO 阅读词汇** 的本地间隔复习（SRS）网页应用，风格类似 Anki：支持牌组、批量导入、英→中识别与中→英拼写、按 topic/pos 筛选、学习统计与薄弱项分析。

本项目为 **纯前端**（TailwindCSS CDN + jQuery + 少量自定义 CSS），默认不依赖后端服务。

---

## 目录

- [特性概览](#特性概览)
- [快速开始](#快速开始)
  - [方式一：直接打开 index.html（最简单）](#方式一直接打开-indexhtml最简单)
  - [方式二：用本地静态服务器打开（更推荐）](#方式二用本地静态服务器打开更推荐)
- [数据存储与隐私](#数据存储与隐私)
- [核心概念（你需要知道的 SRS 术语）](#核心概念你需要知道的-srs-术语)
  - [EF / reps / interval 是什么](#ef--reps--interval-是什么)
  - [新增（new）与复习（review）](#新增new与复习review)
- [导入词表：格式规范](#导入词表格式规范)
  - [推荐导入格式（7 列，TAB 分隔）](#推荐导入格式7-列tab-分隔)
  - [兼容格式](#兼容格式)
  - [导入去重策略](#导入去重策略)
- [复习使用说明（托福向）](#复习使用说明托福向)
  - [复习模式：英→中 vs 中→英（拼写）](#复习模式英中-vs-中英拼写)
  - [筛选：topic / pos](#筛选topic--pos)
  - [每日新增上限](#每日新增上限)
- [统计说明](#统计说明)
  - [今日统计](#今日统计)
  - [按 topic/pos 薄弱项分析（真实正确率）](#按-topicpos-薄弱项分析真实正确率)
  - [趋势图](#趋势图)
- [数据管理：导出 JSON → 修改 → 再导入（方案 B）](#数据管理导出-json--修改--再导入方案-b)
  - [你可以改什么](#你可以改什么)
  - [不要改什么（重要）](#不要改什么重要)
  - [删除卡片/修改标签对统计的影响](#删除卡片修改标签对统计的影响)
- [发音（TTS）说明](#发音tts说明)
- [常见问题](#常见问题)
- [项目结构](#项目结构)
- [License](#license)

---

## 特性概览

- **牌组管理**
  - 创建/选择/重命名/删除牌组
- **导入单词**
  - 支持 TAB 或逗号分隔
  - 支持扩展字段：`pos/topic/syn/collocation/example`
  - 支持导入去重：跳过重复 / 覆盖旧卡
- **复习（类 Anki / SM-2 inspired）**
  - 到期复习队列 + 今日新增队列
  - **英→中（识别）**：看单词、显示释义、打分
  - **中→英（拼写）**：看中文释义、输入英文拼写、自动判定
- **托福定向筛选**
  - 按 **topic（学科主题）**、**pos（词性）** 筛选复习
- **统计**
  - 今日学习量、正确率、到期复习数、待学新卡数
  - **按 topic/pos 的薄弱项分析（基于逐卡事件的真实正确率）**
  - 近 14 天学习趋势
- **备份与迁移**
  - 导出/导入 JSON

---

## 快速开始

### 方式一：直接打开 `index.html`（最简单）

1. 下载/克隆本仓库到本地
2. 双击打开 `index.html`

说明：
- 这种方式最省事，但不同浏览器/不同打开方式对本地存储隔离策略可能不同。
- 如果你希望更稳定，推荐方式二。

### 方式二：用本地静态服务器打开（更推荐）

任何静态服务器都可以，例如：

- Python：
  - `python -m http.server 5173`
  - 访问 `http://localhost:5173`
- Node（任选你习惯的静态服务工具）

说明：
- 这样 `localStorage` 的作用域更稳定，也更接近你部署到 GitHub Pages 的方式。

---

## 数据存储与隐私

- 本应用默认将数据保存在浏览器 **`localStorage`**（本地存储）中
- 不会上传到任何服务器
- 你可以在“统计”页进行：
  - **导出数据（JSON）**：将数据文件保存到你的项目目录或任意位置（推荐放到仓库里备份）
  - **导入备份（JSON）**：从 JSON 文件恢复

本项目的“保存到项目目录”采用 **方案 B**：
- 纯前端网页无法在不经允许的情况下自动写入磁盘文件（浏览器安全限制）
- 因此推荐用“导出/导入 JSON”来实现落盘与 GitHub 备份

---

## 核心概念（你需要知道的 SRS 术语）

### EF / reps / interval 是什么

这些字段来自类 Anki 的间隔复习思想（SM-2 inspired）：

- **EF（易记系数 / Easiness Factor）**
  - 代表这张卡对你来说“有多容易记住”
  - EF 越高，未来的间隔增长越快；EF 越低，间隔增长越慢
  - 初始值通常是 `2.50`

- **reps（连续记住次数 / repetitions）**
  - 代表你连续“记住”的次数（按算法口径）
  - 当你选择“忘了”（grade=0）时通常会重置

- **interval（下次间隔天数 / intervalDays）**
  - 本次复习后，系统安排的“下一次复习间隔”
  - 例如 `interval = 6` 表示 6 天后到期

它们共同决定：你点“忘了/模糊/记得”后，这张卡的 **下次到期时间（dueAt）**。

### 新增（new）与复习（review）

- **新卡（new）**：`lastReviewedAt` 为空的卡
- **复习卡（review）**：至少复习过一次的卡

队列策略（当前实现）：
- 先安排 **到期复习（review）**
- 再安排 **今日新增（new）**（受“每日新增上限”控制）

---

## 导入词表：格式规范

### 推荐导入格式（7 列，TAB 分隔）

每行 1 条，字段用 **TAB** 分隔（不是空格）：

```
word	meaning	example	pos	topic	syn	collocation
```

字段说明：
- `word`：英文单词（建议小写；允许连字符）
- `meaning`：中文释义（建议简洁、托福向）
- `example`：英文例句（托福阅读风格，尽量学术、客观）
- `pos`：词性（建议用 `n/v/adj/adv`）
- `topic`：主题（如 `astronomy/geology/biology` 等）
- `syn`：同义词（英文逗号分隔）
- `collocation`：搭配（英文逗号分隔）

示例：

```
supernova	超新星	A supernova marks the explosive death of a massive star.	n	astronomy	explosion,stellar death	core-collapse supernova,supernova remnant
```

### 兼容格式

导入时支持更少列：

- 2 列：
  - `word	meaning`
- 3 列：
  - `word	meaning	example`

缺失的列会自动置空。

### 导入去重策略

“导入”页右侧可选：
- **跳过重复**：同一牌组内 `word` 相同则跳过
- **覆盖旧卡**：更新 `meaning/example/pos/topic/syn/collocation`，保留复习参数（EF/reps/interval 等）

重复判断规则：`word.trim().toLowerCase()`。

---

## 复习使用说明（托福向）

### 复习模式：英→中 vs 中→英（拼写）

- **英→中（识别）**
  1. 先显示英文单词
  2. 点击“显示释义”
  3. 选择“忘了/模糊/记得”更新间隔

- **中→英（拼写）**
  1. 先显示中文释义
  2. 你输入英文拼写并提交
  3. 系统按拼写是否正确自动打分

托福建议：
- 阅读刷量：英→中
- 写作/口语输出：中→英（拼写）

### 筛选：topic / pos

在复习页可填写：
- `topic`：例如 `astronomy`（大小写不敏感）
- `pos`：例如 `n/v/adj`（前缀匹配，`adj` 可匹配 `adj.`）

点击“应用筛选”后，队列会只从匹配标签的卡里抽取（包括到期复习与今日新学）。

### 每日新增上限

- 控制每天最多学习多少张“新卡”
- 设为 `0` 表示不学新卡，只做复习

---

## 统计说明

### 今日统计

- **今日学习（总）**：今天发生的作答次数（新学 + 复习）
- **今日正确率**：按 `grade >= 3` 视为正确（并显示今日新增数）
- **到期复习**：当前到期且已学过的卡数量
- **待学新卡**：从未复习过的卡数量

### 按 topic/pos 薄弱项分析（真实正确率）

统计页会根据 `logsByDay[date].events` 的逐卡事件：
- 按 `topic` 聚合：统计该 topic 下的作答次数与正确次数
- 按 `pos` 聚合：同理
- 并按“正确率低的排前面”展示薄弱项

说明：
- 如果你导入后还没开始复习，events 为空，则这里会显示暂无数据

### 趋势图

- 近 14 天的学习量柱状趋势

---

## 数据管理：导出 JSON → 修改 → 再导入（方案 B）

这是纯前端项目推荐的“落盘到项目目录”的方式。

### 你可以改什么

在导出的 JSON 中，通常你会改这些字段：

- `decks`
  - 修改 `name`：重命名牌组

- `cards`（重点）
  - `front`：英文单词
  - `back`：中文释义
  - `example`：例句
  - `pos/topic/syn/collocation`：托福标签

常见批量操作：
- 统一 topic：例如把一批卡的 topic 改成 `astronomy`
- 统一 pos：把 `adj.` 规范为 `adj`
- 清洗同义词/搭配：去掉多余空格，统一用英文逗号分隔
- 删除不想要的卡

### 不要改什么（重要）

- 不要改卡片的 `id`
- 不要随意改 `deckId`（除非你明确想把卡移动到另一个 deck，并且 deckId 必须存在）
- 不要把 `cards` 从 object 改成 array（结构必须保持一致）

### 删除卡片/修改标签对统计的影响

- 删除卡片后：历史 `events` 里可能仍存在该 `cardId` 的记录
  - 不会影响导入
  - 统计时找不到卡片会跳过该事件

- 修改 `topic/pos` 后：
  - 后续复习与统计会按新标签计算
  - 历史事件会按照“当前卡片的 topic/pos”去聚合（因为事件里只存 cardId，统计时再取卡片字段）

---

## 发音（TTS）说明

在“中→英（拼写）”区域有“发音”按钮：
- 使用浏览器 Web Speech API：`speechSynthesis`
- 若浏览器不支持，会提示无法发音

建议使用较新的 Chrome/Edge。

---

## 常见问题

### 1. 为什么换浏览器/换电脑后数据不见了？

因为默认数据存放在浏览器的 `localStorage`。

解决：
- 用“统计 → 导出数据（JSON）”备份
- 在新环境“统计 → 导入备份（JSON）”恢复

### 2. 导入后预览为空/导入失败？

常见原因：
- 分隔符不是 TAB，而是空格
- 行内缺少 `word` 或 `meaning`

解决：
- 确保每行至少 `word<TAB>meaning`
- 用“解析并预览”检查错误提示

### 3. 为什么 topic/pos 正确率没有数据？

如果你还没开始复习，没有产生 `logsByDay.events`，就不会有统计。

---

## 项目结构

- `index.html`：单页 UI
- `app.js`：业务逻辑（数据模型、导入、复习调度、统计、备份）
- `app.css`：少量自定义样式（玻璃拟态风格 + 复习卡片排版）

---

## License

MIT
